<!DOCTYPE html>
<html lang="en">
<head><link rel=manifest href=/cms/manifest.json>
  <meta charset="UTF-8">
<meta name="renderer" content="webkit"/>
<meta name="force-rendering" content="webkit"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">

<!-- MODIFIED BY 5972 -->
  <script data-ad-client="ca-pub-3179887013052109" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/social-share.js/1.0.16/css/share.min.css"></link>
  <script src="https://cdn.bootcdn.net/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
  
  <link rel="stylesheet" href="/cms/css/main.css">
  <link rel="stylesheet" href="/cms/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/cms/lib/animate-css/animate.min.css">
  <link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/static/api/css/share.min.css">
  <link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/No5972/Live2D@25/live2d/css/live2d.css" />
  <link rel="stylesheet" href="https://at.alicdn.com/t/c/font_1939188_e51h371envj.css">
  <!-- <link rel="stylesheet" href="https://fonts.font.im/css?family=Noto%20Serif%20TC&display=swap&subset=latin,latin-ext"/> -->
  <!-- <link rel="stylesheet" href="https://fonts.font.im/css?family=Noto%20Serif%20SC&display=swap&subset=latin,latin-ext"/> -->
  <link rel="stylesheet" href="https://fonts.geekzu.org/css?family=Noto+Serif+TC:Regular,Bold"/>
  <link rel="stylesheet" href="https://fonts.geekzu.org/css?family=Noto+Serif+SC:Regular,Bold"/>
  <link rel="stylesheet" href="https://fonts.geekzu.org/css?family=ZCOOL+KuaiLe"/>
  <style>
    #landlord {
      bottom: -100px;
      width: 200px;
      height: 550px;
      left: 0;
    }
    
    #live2d {
      display: block;
      height: 100%;
      width: 100%;
    }
  </style>
  <!-- <script src="https://fastly.jsdelivr.net/gh/No5972/live2d-widget@20/autoload.js"></script> -->
  
  
  <style>
/*
   @font-face
    {
      font-family: CCKT;
      src: url('https://cdn.jsdmirror.com/gh/No5972/Live2D@12/cckt.woff');
    }
*/
    
    @font-face
    {
      font-family: DIN-Bold;
      src: url('https://cdn.jsdmirror.com/gh/No5972/Live2D@10/din-bold-2.otf');
    }

    /* @font-face
    {
        font-family: FreeSerif;
        src: url('https://cdn.jsdmirror.com/gh/No5972/Live2D@22/FreeSerif.otf');
        font-style: normal;
        font-weight: normal;
    }
	
@font-face
{
    font-family: FreeSerif;
    src: url('https://cdn.jsdmirror.com/gh/No5972/Live2D@22/FreeSerif.otf');
    font-style: normal;
    font-weight: normal;
}
    
@font-face
{
    font-family: FreeSerif;
    src: url('https://cdn.jsdmirror.com/gh/No5972/Live2D@22/FreeSerifBold.otf');
    font-style: normal;
    font-weight: bold;
}
    
@font-face
{
    font-family: FreeSerif;
    src: url('https://cdn.jsdmirror.com/gh/No5972/Live2D@22/FreeSerifItalic.otf');
    font-style: italic;
    font-weight: normal;
}
    
@font-face
{
    font-family: FreeSerif;
    src: url('https://cdn.jsdmirror.com/gh/No5972/Live2D@22/FreeSerifBoldItalic.otf');
    font-style: italic;
    font-weight: bold;
}

*/

    .message {
      font-family: 'ZCOOL KuaiLe';
    }
  </style> 
  <style>
    .pace .pace-progress {
      background: #fff !important;
    }
  </style>
<!-- MODIFIED BY 5972 -->
  <link rel="apple-touch-icon" sizes="180x180" href="/cms/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/cms/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/cms/images/favicon.ico">
  <link rel="mask-icon" href="/cms/images/logo.svg" color="#222">

<link rel="stylesheet" href="/cms/css/main.css">


<link rel="stylesheet" href="//unpkg.com/@fortawesome/fontawesome-free@5.13.0/css/all.min.css">
  
  <link rel="stylesheet" href="/cms/lib/animate-css/animate.min.css">
  <link rel="stylesheet" href="//unpkg.com/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script data-pace-options='{ "ajax": false }' src="//unpkg.com/pace-js@1.2.4/pace.min.js"></script>

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"no5972.moe","root":"/cms/","scheme":"Pisces","version":"8.0.0-rc.4","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"path":"search.xml"};
  </script>

  <meta name="description" content="网上有很多关于 WebSocket 用法的文章，但是有一些内容错误或者代码不全的，这里来个全的，方便自己记忆。">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot 集成 WebSocket">
<meta property="og:url" content="https://no5972.moe/cms/archivers/111.html">
<meta property="og:site_name" content="No.5972 Publishment Website">
<meta property="og:description" content="网上有很多关于 WebSocket 用法的文章，但是有一些内容错误或者代码不全的，这里来个全的，方便自己记忆。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img.shields.io/badge/%E5%8D%9A%E5%AE%A2%E5%9B%AD-%E4%BB%85%E6%AD%A4%E8%80%8C%E5%B7%B2%E2%80%94%E8%BF%9C%E6%96%B9-brightgreen">
<meta property="og:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/098d112678c4ce3a6069d712283728b5.png">
<meta property="og:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/0125aadcb2910b4ca22a82e254851683.png">
<meta property="og:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/f55a76be4c8c650bc8121533f5344d95.png">
<meta property="og:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/0a0150c3ba89ca87ffde6ddd0e83d166.png">
<meta property="og:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/b794905998c2bc232406d4da30fb85f5.png">
<meta property="og:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/d74ca599ca01c20ad653f1f8da7ce0b4.png">
<meta property="og:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/2bcc0eedc3e6230a9022f6c16c1839f6.png">
<meta property="og:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/e81a0282a2ac02eb9862e75eef75741a.png">
<meta property="og:image" content="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/2adde634315c6569543a5b54af720a0a.png">
<meta property="article:published_time" content="2021-11-03T08:00:00.000Z">
<meta property="article:modified_time" content="2023-03-15T10:29:24.551Z">
<meta property="article:author" content="No.5972">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.shields.io/badge/%E5%8D%9A%E5%AE%A2%E5%9B%AD-%E4%BB%85%E6%AD%A4%E8%80%8C%E5%B7%B2%E2%80%94%E8%BF%9C%E6%96%B9-brightgreen">

<link rel="canonical" href="https://no5972.moe/cms/archivers/111.html">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>SpringBoot 集成 WebSocket | No.5972 Publishment Website</title>
  <script>
      if (!!window.ActiveXObject || "ActiveXObject" in window) {
        document.write('Please note that this site no longer supports Internet Explorer. Please use <a href=\"https://www.microsoft.com/edge\">Microsoft Edge</a> or other browsers to browse this site.');
        window.onload = function () {
          $("style,link").remove();
        }
        console.log("IE Found!");
        
      }

  </script>
  <script>
function loadJS( url, callback ){
    var script = document.createElement('script'),fn = callback || function(){};
    script.type = 'text/javascript';
    //IE
    if(script.readyState){
        script.onreadystatechange = function(){
            if( script.readyState == 'loaded' || script.readyState == 'complete' ){
                script.onreadystatechange = null;
                fn();
            }
        };
    }else{
        //其他浏览器
        script.onload = function(){
            fn();
        };
    }
    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
}




  </script>
  <style>
#switchBackgroundBtn {
 right: 30px;
 opacity: 0 !important;
 transition: opacity 0.5s;
}

#switchBackgroundBtn {

} 

#switchBackgroundBtn:hover {
 opacity: 1 !important;
} 

@media (max-width: 991px) {
 #switchBackgroundBtn {
  right: 20px;
 } 
}
  </style>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<link rel="alternate" href="/cms/feed.xml" title="No.5972 Publishment Website" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <!-- <div style="position:fixed;width: 100%;height: 100%;background: url(https://cdndata.fairyabc.com/attachment/album/201809/06/161517g07y9z06yfunuuub.jpg);opacity: 0.25; background-size:cover ; background-attachment:fixed; pointer-events: none;" id="customBackground"></div> -->
    <div style="position:fixed;width: 100%;height: 100%;background: url(https://img.xjh.me/random_img.php?type=bg&ctype=acg&return=302);opacity: 0.25; background-size:cover ; background-attachment:fixed; pointer-events: none; display: none;" id="randomBackground"></div>
    <!-- <div style="position:fixed;width: 100%;height: 100%;background: url(https://cdn.jsdelivr.net/gh/No5972/Live2D@13/161517g07y9z06yfunuuub.jpg);opacity: 0.25; background-size:cover ; background-attachment:fixed; pointer-events: none; display: block;" id="customBackground"></div> -->
    <div style="position:fixed;width: 100%;height: 100%;background: url(/cms/static/bg250217-2.jpg);opacity: 0.25; background-size:cover ; background-attachment:fixed; pointer-events: none; display: block;" id="customBackground"></div>
    <div class="back-to-top1" id="switchBackgroundBtn" onclick="toggleRandomBackground()" style="bottom: 60px; box-sizing: border-box; color: #fff; padding: 0 6px; transition: bottom 0.2s ease-in-out; background: #007ff3; cursor: pointer; opacity: 0.6; position: fixed; z-index: 1300; width: 24px; font-size: 12px;"><i class="fa fa-paint-brush"></i></div>
    <div id="cookie-alert" class="cookie-alert" style="position: absolute; width: 100%; height: fit-content; background: white; left: 0; top: 0; display: none; z-index: 1000;">We use cookies to improve your experience on our website. By browsing this website, you agree to our use of cookies. <a href="#" onclick="agreeCookies()">OK</a>&nbsp;|&nbsp;<a href="/cms/cookie-notice">Learn More &gt;</a></div>
    <script>
      

      if(!localStorage.getItem('mask')){
       document.getElementById("cookie-alert").style.display = "block";
      }

      function refreshRandomBackgroundStatus() {
       document.getElementById('randomBackground').style.display = "block";
       if (localStorage.getItem('randomBackground') == 'true') {
        document.getElementById('randomBackground').style.display = "block";
        document.getElementById('customBackground').style.display = "none";
       } else {
        document.getElementById('randomBackground').style.display = "none";
        document.getElementById('customBackground').style.display = "block";
       }
      }

      function toggleRandomBackground() {
       if (localStorage.getItem('randomBackground') == null || localStorage.getItem('randomBackground') == 'false') {
        localStorage.setItem('randomBackground', 'true');
       } else {
        localStorage.setItem('randomBackground', 'false');
       }
       refreshRandomBackgroundStatus();
      }

      refreshRandomBackgroundStatus();
      
      function agreeCookies() {
        document.getElementById("cookie-alert").style.display = "none";
        localStorage.setItem('mask','true');
      }

      window.onload = function () {
        // IE Alert
        if (!!window.ActiveXObject || "ActiveXObject" in window) {
         var p = document.createElement("div");
         p.style.color="#000";
         p.style.position="absolute";
         p.style.width="100%";
         p.style.height="fit-content";
         p.style.background="white";
         p.style.left=0;
         if(!localStorage.getItem('mask')){
           p.style.top="32px";
         } else {
           p.style.top=0;
         }
         p.style.zIndex=1000;
         p.innerHTML = 'Please note that this site no longer supports Internet Explorer. Please use <a href="https://www.microsoft.com/edge" target="_blank" rel="noopener">Microsoft Edge</a> or other browsers to browse this site.'
         document.body.insertBefore(p, document.getElementsByClassName("cookie-alert")[0]);
        }

        const selects = document.querySelectorAll('.lang-select');
        selects.forEach(sel => {
          sel.addEventListener('change', () => {
            const target = sel.options[sel.selectedIndex];
            sessionStorage.setItem("lang", target.label);
          });
        });
        
        $("a[target=_blank]").each (function () { $(this).attr("onclick", "window.open('/cms/confirm.html?' + encodeURI($(this).attr(\"href\"))) ; return false;");} )

        var pageLoadTime = new Date().getTime()  - window.performance.timing.navigationStart;
        if (pageLoadTime > 10000 && location.pathname == "/cms/") {
         loadJS("https://cdn.bootcdn.net/ajax/libs/layer/3.1.1/layer.min.js?v=" + new Date().getTime(), function () {
          layer.msg('本次访问网站消耗了 ' + pageLoadTime + ' 毫秒，访问较慢，推荐访问国内镜像站 https://no5972.gitee.io ，访问更快。', {
            time: 10000, //20s后自动关闭
            btn: ['确认', '取消'],
            yes: function () {
              location.href="https://no5972.gitee.io/cms";
            }
          })
         })
        }
      }

      if (sessionStorage.getItem("lang") == "简体中文" && location.href.lastIndexOf("zh-CN") == -1) { 
        location.href = location.href.replace("/cms/", "/cms/zh-CN/");
      }

/*
window.onload = function () {
	if (navigator.userAgent.lastIndexOf("Macintosh") != -1 || navigator.userAgent.lastIndexOf("Windows NT") != -1) {
	if (navigator.platform.lastIndexOf("Linux arm") == -1) { // 手机浏览器不支持视频透明
		var v = document.createElement("video");
		v.src = "https://cdn.jsdelivr.net/gh/No5972/Live2D@master-1/2ce423abb276a932119.mp4";	
		v.loop = true;
		v.autoplay = true;
		v.currentTime = 40;
		$(v).css("height" ,"100%");
		$(v).css("width" ,"100%");
		$(v).css("object-fit" ,"fill");


		$("#customBackground").html("");
		$("#customBackground").append(v);
		$("#customBackground").find("video")[0].play();
	}
	}
}
*/

    </script>
    <!-- <script>
      (function(d) {
        var config = {
          kitId: 'cwe3tnz',
          scriptTimeout: 3000,
          async: true
        },
        h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
      })(document);
    </script> -->

    <main class="main">

      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/cms/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">No.5972 Publishment Website</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Easier than easy.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-return">

    <a href="https://no5972.github.io/" rel="noopener" target="_blank"><i class="fa fa-reply fa-fw"></i>Return</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/cms/about.html" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/cms/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/cms/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-toolkit">

    <a href="/cms/archivers/4.html" rel="section"><i class="fa fa-wrench fa-fw"></i>Toolkit</a>

  </li>
        <li class="menu-item menu-item-donate">

    <a href="https://afdian.com/@wujiuqier" rel="noopener" target="_blank"><i class="fa fa-heart fa-fw"></i>Donate</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar" style="background: #fff2; padding: 20px 0;">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active" style="display: contents;">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-text"> 前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#说明"><span class="nav-text"> 说明</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#代码示例"><span class="nav-text"> 代码示例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-自己给自己发消息"><span class="nav-text"> 1、自己给自己发消息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-自己给所有客户端发送消息不包括自己"><span class="nav-text"> 2、自己给所有客户端发送消息（不包括自己）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-自己给另一个客户端发送消息"><span class="nav-text"> 3、自己给另一个客户端发送消息</span></a></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="No.5972"
      src="https://no5972.moe/cms/static/32865305.jpg">
  <p class="site-author-name" itemprop="name">No.5972</p>
  <div class="site-description" itemprop="description">No.5972 is silly B</div>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/No5972" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;No5972" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/14547429/no-5972" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;14547429&#x2F;no-5972" rel="noopener" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wujiuqier#foxmail.com" title="E-Mail → mailto:wujiuqier#foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/cms/feed.xml" title="RSS → &#x2F;feed.xml"><i class="fa fa-rss fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.cnblogs.com/wujiuqier" title="CNBlogs → https:&#x2F;&#x2F;www.cnblogs.com&#x2F;wujiuqier" rel="noopener" target="_blank"><i class="iconfont icon-CN_cnblogs fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/12551304" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;12551304" rel="noopener" target="_blank"><i class="iconfont icon-bilibili-fill fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/wujiuqier" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;wujiuqier" rel="noopener" target="_blank"><i class="iconfont icon-zhihu fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://tieba.baidu.com/home/main?un=wujiuqier" title="Tieba → https:&#x2F;&#x2F;tieba.baidu.com&#x2F;home&#x2F;main?un&#x3D;wujiuqier" rel="noopener" target="_blank"><i class="iconfont icon-tieba fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.pixiv.net/en/users/17358156/" title="Pixiv → https:&#x2F;&#x2F;www.pixiv.net&#x2F;en&#x2F;users&#x2F;17358156&#x2F;" rel="noopener" target="_blank"><i class="iconfont icon-pixiv fa-fw"></i></a>
      </span>
  </div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/cms/archives/">
        
          <span class="site-state-item-count">178</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>

    
                <nav class="site-nav">
                  <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/cms/categories/AIGC/">AIGC</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/Animation/">Animation</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/AtoW/">AtoW</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/Automation/">Automation</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/C/">C#</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/C-C/">C/C++</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/Github/">Github</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/Hardware/">Hardware</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/Java/">Java</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/JavaScript/">JavaScript</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/Mathematics/">Mathematics</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/Moving-Away-from-Flash/">Moving Away from Flash</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/Other/">Other</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/PowerShell/">PowerShell</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/Python/">Python</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/Web-Building/">Web Building</a><span class="category-list-count">24</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/Webapp/">Webapp</a><span class="category-list-count">42</span></li><li class="category-list-item"><a class="category-list-link" href="/cms/categories/jekyll-update/">jekyll update</a><span class="category-list-count">4</span></li></ul>
                </nav>
                <nav class="site-nav" style="width: 80%; overflow-x: hidden;">
                  <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/cms/archivers/174.html">Win11 使用 QEMU 虚拟机运行 VC6 的可行性</a></li><li class="post-list-item"><a class="post-list-link" href="/cms/archivers/173.html">Win11 使用 Copy v86 在线网页运行 VC6 学习 C 语言的可行性</a></li><li class="post-list-item"><a class="post-list-link" href="/cms/archivers/172.html">仅作笔记用：利用 AI 大模型将 DNF 角色截图转换成手办图（推荐模型 Gemini 2.5 Flash Image）</a></li><li class="post-list-item"><a class="post-list-link" href="/cms/archivers/171.html">仅作笔记用：其他盘的页面文件突然不见了怎么办</a></li><li class="post-list-item"><a class="post-list-link" href="/cms/archivers/170.html">实用为先! 图说Photoshop 6.0轻松入门四步走</a></li><li class="post-list-item"><a class="post-list-link" href="/cms/archivers/169.html">关于 Win7 运行豆包桌面版提示无法定位程序输入点，无法运行的问题</a></li></ul>
                </nav>
              
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/No5972" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://no5972.moe/cms/archivers/111.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://no5972.moe/cms/static/32865305.jpg">
      <meta itemprop="name" content="No.5972">
      <meta itemprop="description" content="No.5972 is silly B">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="No.5972 Publishment Website">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
          SpringBoot 集成 WebSocket
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-11-03 16:00:00 | Modified: 2023-03-15 18:29:24" itemprop="dateCreated datePublished" datetime="2021-11-03T16:00:00+08:00">2021-11-03 16:00:00</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/cms/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>来源：<a href="https://www.cnblogs.com/xuwenjin/p/12664650.html" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/%E5%8D%9A%E5%AE%A2%E5%9B%AD-%E4%BB%85%E6%AD%A4%E8%80%8C%E5%B7%B2%E2%80%94%E8%BF%9C%E6%96%B9-brightgreen" alt="博客园-仅此而已-远方" /></a></p>
<h1 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h1>
<p>WebSocket 是一种在单个 <a href="https://baike.baidu.com/item/TCP" target="_blank" rel="noopener">TCP</a> 连接上进行<a href="https://baike.baidu.com/item/%E5%85%A8%E5%8F%8C%E5%B7%A5" target="_blank" rel="noopener">全双工</a>通信的协议。WebSocket 通信协议于 2011 年被 <a href="https://baike.baidu.com/item/IETF" target="_blank" rel="noopener">IETF</a> 定为标准 RFC 6455，并由 RFC 7936 补充规范。WebSocket <a href="https://baike.baidu.com/item/API" target="_blank" rel="noopener">API</a> 也被 <a href="https://baike.baidu.com/item/W3C" target="_blank" rel="noopener">W3C</a> 定为标准。WebSocket 使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。在 WebSocket API 中，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输。</p>
<h1 id="说明"><a class="markdownIt-Anchor" href="#说明"></a> 说明</h1>
<p>本篇主要介绍在 SpringBoot 框架下，WebSocket 基于注解使用的 3 种场景：</p>
<ol>
<li>自己给自己发消息</li>
<li>自己给所有客户端发送消息（不包括自己）</li>
<li>自己给另一个客户端发送消息</li>
</ol>
<h1 id="代码示例"><a class="markdownIt-Anchor" href="#代码示例"></a> 代码示例</h1>
<p>代码结构如下：<br />
<img src="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/098d112678c4ce3a6069d712283728b5.png" alt="" /></p>
<p>POM 文件中的依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- websocket --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- fastjson --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>application.yml</code> 文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">18092</span></span><br></pre></td></tr></table></figure>
<p>WebSocket 配置文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注入一个 ServerEndpointExporter，该 Bean 会自动注册使用 <span class="doctag">@ServerEndpoint</span> 注解申明的 WebSocket Endpoint</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServerEndpointExporter <span class="title">serverEndpointExporter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServerEndpointExporter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 <code>resources</code> 目录中创建一个 <code>static</code> 文件夹，然后新建一个 <code>index.html</code> 页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>My WebSocket<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"text"</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"send()"</span>&gt;</span>Send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"closeWebSocket()"</span>&gt;</span>Close<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"message"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> websocket = <span class="literal">null</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 判断当前浏览器是否支持 WebSocket，主要此处要更换为自己的地址</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (<span class="string">'WebSocket'</span> <span class="keyword">in</span> <span class="built_in">window</span>) &#123;</span></span><br><span class="line"><span class="actionscript">        websocket = <span class="keyword">new</span> WebSocket(<span class="string">"ws://localhost:18092/test/one"</span>);</span></span><br><span class="line"><span class="actionscript">    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">        alert(<span class="string">'Not support websocket'</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 连接发生错误的回调方法</span></span></span><br><span class="line"><span class="actionscript">    websocket.onerror = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        setMessageInnerHTML(<span class="string">"error"</span>);</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 连接成功建立的回调方法</span></span></span><br><span class="line"><span class="actionscript">    websocket.onopen = <span class="function"><span class="keyword">function</span><span class="params">(event)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">//setMessageInnerHTML("open");</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 接收到消息的回调方法</span></span></span><br><span class="line"><span class="actionscript">    websocket.onmessage = <span class="function"><span class="keyword">function</span><span class="params">(event)</span> </span>&#123;</span></span><br><span class="line">        setMessageInnerHTML(event.data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 连接关闭的回调方法</span></span></span><br><span class="line"><span class="actionscript">    websocket.onclose = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        setMessageInnerHTML(<span class="string">"close"</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 监听窗口关闭事件，当窗口关闭时，主动去关闭 WebSocket 连接，防止连接还没断开就关闭窗口，服务端会抛异常。</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onbeforeunload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line">        websocket.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 将消息显示在网页上</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">setMessageInnerHTML</span><span class="params">(innerHTML)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">'message'</span>).innerHTML += innerHTML + <span class="string">'&lt;br/&gt;'</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 关闭连接</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">closeWebSocket</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line">        websocket.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// 发送消息</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> message = <span class="built_in">document</span>.getElementById(<span class="string">'text'</span>).value;</span></span><br><span class="line">        websocket.send(message);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>对应上面的 3 种场景，分别给出代码：</p>
<h2 id="1-自己给自己发消息"><a class="markdownIt-Anchor" href="#1-自己给自己发消息"></a> 1、自己给自己发消息</h2>
<p>创建一个 <code>OneWebSocket</code> 类，用来服务端与客户端进行交互：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 前后端交互的类实现消息的接收推送（自己发送给自己）</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ServerEndpoint</span>(value = "/test/one") 前端通过此 URI 和后端交互，建立连接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@ServerEndpoint</span>(value = <span class="string">"/test/one"</span>)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OneWebSocket</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 记录当前在线连接数 </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AtomicInteger onlineCount = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接建立成功调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">        onlineCount.incrementAndGet(); <span class="comment">// 在线数加 1</span></span><br><span class="line">        log.info(<span class="string">"有新连接加入：&#123;&#125;，当前在线人数为：&#123;&#125;"</span>, session.getId(), onlineCount.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接关闭调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClose</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">        onlineCount.decrementAndGet(); <span class="comment">// 在线数减 1</span></span><br><span class="line">        log.info(<span class="string">"有一连接关闭：&#123;&#125;，当前在线人数为：&#123;&#125;"</span>, session.getId(), onlineCount.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 收到客户端消息后调用的方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     *            客户端发送过来的消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(String message, Session session)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"服务端收到客户端[&#123;&#125;]的消息:&#123;&#125;"</span>, session.getId(), message);</span><br><span class="line">        <span class="keyword">this</span>.sendMessage(<span class="string">"Hello, "</span> + message, session);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnError</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Session session, Throwable error)</span> </span>&#123;</span><br><span class="line">        log.error(<span class="string">"发生错误"</span>);</span><br><span class="line">        error.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 服务端发送消息给客户端</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String message, Session toSession)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.info(<span class="string">"服务端给客户端[&#123;&#125;]发送消息&#123;&#125;"</span>, toSession.getId(), message);</span><br><span class="line">            toSession.getBasicRemote().sendText(message);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"服务端发送消息给客户端失败：&#123;&#125;"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>其中 <code>@ServerEndpoint</code> 注解是服务端与客户端交互的关键，其值 (<code>/test/one</code>) 得与 <code>index</code> 页面中的请求路径对应。</p>
<p>启动服务，在浏览器请求 <code>http://localhost:18092/index.html</code> ，如下所示：<br />
<img src="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/0125aadcb2910b4ca22a82e254851683.png" alt="" /></p>
<p>请求一发出，立马就会建立服务端与客户端的连接。服务端打印日志如下：<br />
<img src="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/f55a76be4c8c650bc8121533f5344d95.png" alt="" /></p>
<p>在文本框中输入内容：“你好”，然后点击 Send 按钮，浏览器效果：<br />
<img src="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/0a0150c3ba89ca87ffde6ddd0e83d166.png" alt="" /></p>
<p>服务端日志：<br />
<img src="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/b794905998c2bc232406d4da30fb85f5.png" alt="" /></p>
<p>（备注：服务端关闭或者浏览器关闭的效果，都会导致连接断开，这里不演示）</p>
<h2 id="2-自己给所有客户端发送消息不包括自己"><a class="markdownIt-Anchor" href="#2-自己给所有客户端发送消息不包括自己"></a> 2、自己给所有客户端发送消息（不包括自己）</h2>
<p>创建一个 <code>OneToManyWebSocket</code> 类，用来服务端与客户端进行交互：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 前后端交互的类实现消息的接收推送（自己发送给所有人（不包括自己））</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ServerEndpoint</span>(value = "/test/oneToMany") 前端通过此 URI 和后端交互，建立连接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@ServerEndpoint</span>(value = <span class="string">"/test/oneToMany"</span>)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OneToManyWebSocket</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 记录当前在线连接数 </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AtomicInteger onlineCount = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 存放所有在线的客户端 </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Session&gt; clients = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接建立成功调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">        onlineCount.incrementAndGet(); <span class="comment">// 在线数加 1</span></span><br><span class="line">        clients.put(session.getId(), session);</span><br><span class="line">        log.info(<span class="string">"有新连接加入：&#123;&#125;，当前在线人数为：&#123;&#125;"</span>, session.getId(), onlineCount.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接关闭调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClose</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">        onlineCount.decrementAndGet(); <span class="comment">// 在线数减 1</span></span><br><span class="line">        clients.remove(session.getId());</span><br><span class="line">        log.info(<span class="string">"有一连接关闭：&#123;&#125;，当前在线人数为：&#123;&#125;"</span>, session.getId(), onlineCount.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 收到客户端消息后调用的方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     *            客户端发送过来的消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(String message, Session session)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"服务端收到客户端[&#123;&#125;]的消息:&#123;&#125;"</span>, session.getId(), message);</span><br><span class="line">        <span class="keyword">this</span>.sendMessage(message, session);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnError</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Session session, Throwable error)</span> </span>&#123;</span><br><span class="line">        log.error(<span class="string">"发生错误"</span>);</span><br><span class="line">        error.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 群发消息</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     *            消息内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String message, Session fromSession)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Session&gt; sessionEntry : clients.entrySet()) &#123;</span><br><span class="line">            Session toSession = sessionEntry.getValue();</span><br><span class="line">            <span class="comment">// 排除掉自己</span></span><br><span class="line">            <span class="keyword">if</span> (!fromSession.getId().equals(toSession.getId())) &#123;</span><br><span class="line">                log.info(<span class="string">"服务端给客户端[&#123;&#125;]发送消息&#123;&#125;"</span>, toSession.getId(), message);</span><br><span class="line">                toSession.getAsyncRemote().sendText(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将 <code>index.html</code> 页面的路径改为 <code>/test/oneToMany</code>。重启服务，在浏览器开多个页面。服务端日志如下：<br />
<img src="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/d74ca599ca01c20ad653f1f8da7ce0b4.png" alt="" /></p>
<p>在浏览器第一个页面中输入内容：“你好”，会发现其它页面都收到了消息“你好”。服务端日志如下：<br />
<img src="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/2bcc0eedc3e6230a9022f6c16c1839f6.png" alt="" /></p>
<h2 id="3-自己给另一个客户端发送消息"><a class="markdownIt-Anchor" href="#3-自己给另一个客户端发送消息"></a> 3、自己给另一个客户端发送消息</h2>
<p>创建一个 <code>OneToOneWebSocket</code> 类，用来服务端与客户端进行交互：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 前后端交互的类实现消息的接收推送（自己发送给另一个人）</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ServerEndpoint</span>(value = "/test/oneToOne") 前端通过此 URI 和后端交互，建立连接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@ServerEndpoint</span>(value = <span class="string">"/test/oneToOne"</span>)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OneToOneWebSocket</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 记录当前在线连接数 </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AtomicInteger onlineCount = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 存放所有在线的客户端 </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Session&gt; clients = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接建立成功调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">        onlineCount.incrementAndGet(); <span class="comment">// 在线数加 1</span></span><br><span class="line">        clients.put(session.getId(), session);</span><br><span class="line">        log.info(<span class="string">"有新连接加入：&#123;&#125;，当前在线人数为：&#123;&#125;"</span>, session.getId(), onlineCount.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接关闭调用的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClose</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">        onlineCount.decrementAndGet(); <span class="comment">// 在线数减 1</span></span><br><span class="line">        clients.remove(session.getId());</span><br><span class="line">        log.info(<span class="string">"有一连接关闭：&#123;&#125;，当前在线人数为：&#123;&#125;"</span>, session.getId(), onlineCount.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 收到客户端消息后调用的方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     *            客户端发送过来的消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(String message, Session session)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"服务端收到客户端[&#123;&#125;]的消息[&#123;&#125;]"</span>, session.getId(), message);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MyMessage myMessage = JSON.parseObject(message, MyMessage<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            <span class="keyword">if</span> (myMessage != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Session toSession = clients.get(myMessage.getUserId());</span><br><span class="line">                <span class="keyword">if</span> (toSession != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.sendMessage(myMessage.getMessage(), toSession);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"解析失败：&#123;&#125;"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnError</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Session session, Throwable error)</span> </span>&#123;</span><br><span class="line">        log.error(<span class="string">"发生错误"</span>);</span><br><span class="line">        error.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 服务端发送消息给客户端</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String message, Session toSession)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.info(<span class="string">"服务端给客户端[&#123;&#125;]发送消息[&#123;&#125;]"</span>, toSession.getId(), message);</span><br><span class="line">            toSession.getBasicRemote().sendText(message);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"服务端发送消息给客户端失败：&#123;&#125;"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将 <code>index.html</code> 页面的路径改为 <code>/test/oneToOne</code>。重启服务，在浏览器打开两个页面。</p>
<p>由于服务端是解析的 JSON 字符串，这里为了简单起见，直接在浏览器输入 JSON 字符串：<code>{&quot;message&quot;:&quot;你好&quot;, &quot;userId&quot;:1}</code>。另一个页面收到了消息：<br />
<img src="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/e81a0282a2ac02eb9862e75eef75741a.png" alt="" /></p>
<p>服务端日志：<br />
<img src="https://images.weserv.nl/?url=https://img-blog.csdnimg.cn/img_convert/2adde634315c6569543a5b54af720a0a.png" alt="" /></p>
<p>至此，所有场景演示完毕。</p>
<link rel="stylesheet" href="/cms/css/spoiler.css" type="text/css"><script src="/cms/js/spoiler.js" type="text/javascript" async></script>
    </div>

    
    
    
         <div style="color: #888a; font-family: DIN-Bold; background: #eee5; padding: 10px; margin-bottom: 10px;">Publishing this article is for the purpose of conveying more information, and does not mean agreeing with its views or confirming its description, nor does it mean that we are responsible for its authenticity. Should you have any questions or doubts about the content of the post, please don't hesitate to contact us. We will respond to you and deal with it as quickly as possible.</div>

      <footer class="post-footer">

        
  <!-- <div class="addthis_inline_share_toolbox">
    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=SHUTDOWN" async="async"></script>
  </div> -->
  <div class="social-share" data-sites="weibo,wechat,qq,qzone,facebook,twitter,linkedin" data-title='Win11 使用 QEMU 虚拟机运行 VC6 的可行性' data-description='上次探讨了使用 Copy v86 在线网页运行 VC6 的可行性，但是仍然存在一些缺陷，保存文件不是很方便，不能输入和显示中文，也不能写 MFC 程序（这个和前面那个不能输入和显示中文有关，这个英文版的 VC6 把 MFC 相关的开发环境给精简掉了）。这里再探讨一下可否使用 QEMU 虚拟机在 Win11 运行 VC6。 庆幸的是，有一个很简便的可以导入磁盘镜像一键启动的绿色免安装单文件直接运行的图形界面的工具《QEMU 启动测试器》，可以直接运行 QEMU 虚拟机，这样就不需要安装虚拟机软件了。这个启动的操作比网页版稍微复杂一点点，不过也只是复杂一点点。' style="text-align: center; margin: 1rem 0;"></div>
  <div class="ad" style="text-align: center;">
    <a href="https://curl.qcloud.com/JuZ5tVw9" target="_blank"><img src="/cms/static/ad.jpg"></img></a>
  </div>


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/cms/archivers/110.html" rel="prev" title="Windows 11 运行安卓应用 资料汇总">
      <i class="fa fa-chevron-left"></i> Windows 11 运行安卓应用 资料汇总
    </a></div>
      <div class="post-nav-item">
    <a href="/cms/archivers/112.html" rel="next" title="仅作笔记用：PMX Editor 修改贴图材质">
      仅作笔记用：PMX Editor 修改贴图材质 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2011 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="author" itemprop="copyrightHolder">No.5972</span>
</div>

<div class="copyright" style="
    vertical-align: middle;
">
<a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-sa/4.0/" style="
    padding-right: 10px;
    border: none;
"><img alt="Creative Commons License" style="border-width:0;margin: unset;/* max-width: unset; */display: inline;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAABGdBTUEAANbY1E9YMgAAAJZQTFRF////7u7u3d3dys7KzMzMyMzIxsrGxcbFur+6u7u7s7iyq7GqqqqqmZmZlJmTj5CPiIiIh4eHhoaGgICAfYJ9d3d3cnZxZ2tnZmZmW15bVVVVS0xLREREQ0NDQkJCQUJBOz07OTs5MzMzMTMxLjAuJygnJCUjIiIiISEhICAgGRkZERERDxAPDg4ODQ4NDQ0NDQ0MAAAADbeuvgAAANNJREFUeNqtk2kTgiAQhl/KzlWzgw6j+7Ayq/3/f64hTPNLNskOMMwuPLzsAtiygWHVNJC0TThIXSrxierXv/UZoJ8E2SHqQNQeVgSuT7lqh2dEjXk14C2AE7ESiiMHakdU773igF5keu5AKXDEHUQhpIyF50LeiNotEzct4+XO78AxO0JXJdzqO8uEqNvMBKUaYcbXDD8qVNNYSA/yXlRYEISfFNI9gBvzVCje1rDYF3L4sf+d03Lg5my5yv6jnwGXRwvvkMY8SHmrS9WfYvsvW7YnkDuZd7/ChBQAAAAASUVORK5CYII="></a>
    <p style="display:inline-block;margin:0;">Original content of this site, except those works that are given appropriate credits, is licensed under a<br> <a rel="license noopener" href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
</div>
  <div class="powered-by">
    <a href="/cms/cookie-notice">Cookie Notice</a>
    &nbsp;|&nbsp;
    <a href="https://github.com/No5972/cms_source" target="_blank" rel="noopener">Site Source</a>
    &nbsp;|&nbsp;Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 4.2.1 & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 8.0.0-rc.4
  </div>

        
<br>
<span id="daysCount"></span>
<script>
  document.getElementById("daysCount").innerText = " " + parseInt(Math.abs(new Date()  -  new Date("2018-11-14"))  /  1000  /  60  /  60  /24)   + " days since this blog's being founded";
</script>







      </div>
    </footer>
  </div>

  
  <script src="//unpkg.com/animejs@3.1.0/lib/anime.min.js"></script>
  <script src="//unpkg.com/medium-zoom@1/dist/medium-zoom.min.js"></script>


<script src="//unpkg.com/hexo-theme-next@8.0.0-rc.5/source/js/utils.js"></script>
  <script src="//unpkg.com/hexo-theme-next@8.0.0-rc.5/source/js/motion.js"></script>


<script src="//unpkg.com/hexo-theme-next@8.0.0-rc.5/source/js/next-boot.js"></script>

  




  
<script src="//unpkg.com/hexo-theme-next@8.0.0-rc.4/source/js/local-search.js"></script>



<!--
<div id="landlord">
    <div class="message" style="opacity:0; left: 10px;"></div>
    <!-- <canvas id="live2d" width="280" height="550" class="live2d"></canvas> --
    <iframe src="https://test-review.cdn.bcebos.com/mmd/index.html" frameborder="no" style="width: 100%; height: 100%"></iframe>
    <div class="hide-button" style="top: 50px !important">隐藏</div>
</div>
-->

<script src="https://www.unpkg.com/jquery@3.5.1/dist/jquery.min.js"></script>

<script src="https://unpkg.com/jquery.marquee@1.5.0/jquery.marquee.min.js" type="text/javascript"></script>
<div class="marquee-container" style="position: fixed; width: 100%; height: 30px; color: black; background-color: white; left: 0; bottom: 0; display: none;">
<div class="marquee">推进创文常态化 共建文明襄阳城　·　🄽🄾5️⃣9️⃣7️⃣2️⃣　·　做文明襄阳人 建文明襄阳城 凝聚文明正能量 筑梦千年古襄阳　·　🄽🄾5️⃣9️⃣7️⃣2️⃣　·　创建全国文明城市 加快建设汉江流域中心城市　·　🄽🄾5️⃣9️⃣7️⃣2️⃣　·　讲文明 树新风　·　🄽🄾5️⃣9️⃣7️⃣2️⃣　·　用微笑融化陌生 用文明美化襄阳　·　🄽🄾5️⃣9️⃣7️⃣2️⃣　·　争当文明使者 播撒文明新风</div>
</div>
<script>$('.marquee').marquee({duration: 25000});</script>

<!-- mmd3d begin -->
<script type="text/javascript">
    var message_Path = 'https://fastly.jsdelivr.net/gh/No5972/Live2D@25/live2d/'
    var home_Path = 'https://no5972.github.io/cms/'  //此处修改为你的域名，必须带斜杠
</script>
<script type="text/javascript" src="https://fastly.jsdelivr.net/gh/No5972/Live2D@25/live2d/js/message.js"></script>
<!-- mmd3d end -->

<!-- public live2d start -->
<!--
<script type="text/javascript">
    var message_Path = 'https://fastly.jsdelivr.net/gh/No5972/Live2D@24/live2d/'
    var home_Path = 'https://no5972.github.io/cms/'  //此处修改为你的域名，必须带斜杠
</script>
<script type="text/javascript" src="https://fastly.jsdelivr.net/gh/No5972/Live2D@11/live2d/js/live2d.js"></script>
<script type="text/javascript" src="https://fastly.jsdelivr.net/gh/No5972/Live2D@11/live2d/js/message.js"></script>
<script type="text/javascript" src="https://apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
<script type="text/javascript">
    loadlive2d("live2d", "https://fastly.jsdelivr.net/gh/QiShaoXuan/live2DModel@1.0.0/live2d-widget-model-miku/assets/miku.model.json");
    $("#landlord").draggable();
</script>
-->
<!-- public live2d end -->




<script>
    $(document).on('mouseenter', 'button:contains(Donate)', function(){
        $("#post-reward").show();
    }).on('mouseleave', 'button:contains(Donate)', function(){
        $("#post-reward").hide();
    });
</script>











  

  
      
<link rel="stylesheet" href="//unpkg.com/katex@0.15.1/dist/katex.min.css">


  

<script>if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/cms/sw.js?t=1761645803576')
    .then(function () {console.log('ServiceWorker Register Successfully.')})
    .catch(function (e) {console.error(e)});
}
</script></body>
</html>
